@using MudBlazor;
@using NBG.Visitor.Storage.Dtos;
@using NBG.Visitor.Domain;

@inject IDialogService DialogService;
@inject IVisitService vs;
@implements IMainLayout;

<style>
    body {
        background-color: #EEE;
    }
</style>

<MudThemeProvider Theme="NBG"/>

<header>
    @header
</header>

<CascadingValue Value="this">
    <MudCarousel Style="height: 100vh;" @ref="carousel" AutoCycle="false" ShowArrows="false" ShowDelimiters="false" TData="object">
        <MudCarouselItem>
            <TerminalHome OnNext=@(() => carousel.Next()) />
        </MudCarouselItem>
        <MudCarouselItem>
            <TerminalRegister @ref="form" OnBack=@(() => carousel.Previous()) OnNext=@(() => carousel.Next()) />
        </MudCarouselItem>
        <MudCarouselItem>
            <TerminalSafety OnBack=@(() => carousel.Previous()) OnRegister=Register/>
        </MudCarouselItem>
    </MudCarousel>
</CascadingValue>

<footer>
    @footer
</footer>

@code {
    private RenderFragment header;
    private MudCarousel<object> carousel;
    private RenderFragment footer;

    private TerminalRegister form;

    public void SetHeader(RenderFragment header)
    {
        this.header = header;
        StateHasChanged();
    }

    public void SetFooter(RenderFragment footer)
    {
        this.footer = footer;
        StateHasChanged();
    }

    MudTheme NBG = new MudTheme()
    {
        Palette = new Palette()
        {
            Primary = Colors.Red.Darken1,
            Secondary = Colors.Grey.Lighten2,
            SecondaryContrastText = Colors.Grey.Darken2
        }
    };

    private async void Register()
    {
        await vs.AddVisit(DateTime.Now, form.FormData.ContactPerson, form.FormData.Company, form.FormData.FirstName, form.FormData.LastName, form.FormData.PhoneNumber, form.FormData.Email);
        DialogService.Show<MudText>("Besuch erfolgreich angelegt");
        form.Reset();
        carousel.MoveTo(0);
    }
}
