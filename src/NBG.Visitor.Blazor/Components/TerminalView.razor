@using MudBlazor;
@using NBG.Visitor.Domain.Dtos;
@using NBG.Visitor.Domain;
@using System.Reflection

@inject IDialogService DialogService;
@inject IVisitService vs;
@*@implements IMainLayout;*@

<link href="_content/NBG.Visitor.Blazor/css/site.css" rel="stylesheet"/>

<MudThemeProvider Theme="NBG"/>

@*<header>
    @header
</header>*@

@*<CascadingValue Value="this">*@
<CascadingValue Value="Loc">
    <MudCarousel Style="height: 100vh;" @ref="carousel" AutoCycle="false" ShowArrows="false" ShowDelimiters="false" TData="object">
        <MudCarouselItem>
            <TerminalHome OnNext=@(() => carousel.Next()) />
        </MudCarouselItem>
        <MudCarouselItem>
            <TerminalRegister @ref="form" OnBack=@(() => carousel.Previous()) OnNext=@(() => carousel.Next()) />
        </MudCarouselItem>
        <MudCarouselItem>
            <TerminalSafety OnBack=@(() => carousel.Previous()) OnRegister=Register/>
        </MudCarouselItem>
    </MudCarousel>
</CascadingValue>
@*</CascadingValue>*@

@*<footer>
    @footer
</footer>*@

@code {
    private Localizer Loc = new("NBG.Visitor.Blazor.Resources.LangTerminal", Assembly.GetExecutingAssembly(), "de-DE");

    //private RenderFragment header;
    private MudCarousel<object> carousel;
    //private RenderFragment footer;

    private TerminalRegister form;

    //public void SetHeader(RenderFragment header)
    //{
    //    this.header = header;
    //    StateHasChanged();
    //}

    //public void SetFooter(RenderFragment footer)
    //{
    //    this.footer = footer;
    //    StateHasChanged();
    //}

    MudTheme NBG = new MudTheme()
        {
            Palette = new Palette()
            {
                Primary = Colors.Red.Darken1,
                Secondary = Colors.Grey.Lighten2,
                AppbarBackground = Colors.Red.Default,  //TODO
                SecondaryContrastText = Colors.Grey.Darken2
        }
    };

    private async void Register(RegisteredEventArgs e)
    {
        await vs.AddVisit(DateTime.Now, form.FormData.ContactPerson, form.FormData.Company, form.FormData.FirstName, form.FormData.LastName, form.FormData.PhoneNumber, form.FormData.Email);
        DialogService.Show<MudText>(e.Message);
        form.Reset();
        carousel.MoveTo(0);
    }
}
