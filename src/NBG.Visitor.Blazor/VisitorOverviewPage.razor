@using AutoMapper
@using MudBlazor;
@using NBG.Visitor.Blazor.Dtos
@using NBG.Visitor;
@using NBG.Visitor.Services.DB;
@using NBG.Visitor.Blazor.Mapping;

<h3>VisitorOverviewPage</h3>

@if (!isLoaded)
{
    <p><em>Loading Visitors...</em></p>
}
else
{
    <MudTable style="height:100%" Items=@Visits Dense="@dense" Hover="@hover" Bordered="@bordered" Striped="@striped">
        <ToolBarContent>
            <MudText Typo="Typo.h6">Visits</MudText>
            <MudSpacer />
            <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>Id</MudTh>
            <MudTh>Start</MudTh>
            <MudTh>End</MudTh>
            <MudTh>First Name</MudTh>
            <MudTh>Last Name</MudTh>
            <MudTh>Contact Person</MudTh>
            <MudTh>Company</MudTh>
            <MudTh>Status</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Id</MudTd>
            <MudTd>@context.VisitStart</MudTd>
            <MudTd>@context.VisitEnd</MudTd>
            <MudTd>@context.Visitor.FirstName</MudTd>
            <MudTd>@context.Visitor.LastName</MudTd>
            <MudTd>@context.ContactPerson.Name</MudTd>
            <MudTd>@context.Company.CompanyLabel</MudTd>
            <MudTd>@context.Status</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager/>
        </PagerContent>
    </MudTable>
}

@code {
    bool isLoaded;
    private string searchString = "";
    private bool dense = false;
    private bool hover = true;
    private bool striped = true;
    private bool bordered = false;
    private int[] pageSizeOptions = new int[] { 11 };

    protected override async Task OnInitializedAsync()
    {
        var config = new AutoMapperConfiguration().Configure();
        var mapper = config.CreateMapper();
        var visits = await _repo.ReadAllVisits();
        foreach(var v in visits){
            Visits.Add(mapper.Map<VisitDto>(v));
        }
        isLoaded = true;

    }
    
    private List<VisitDto> Visits = new List<VisitDto>();
    private VisitRepository _repo = new VisitRepository();
}