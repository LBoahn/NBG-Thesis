@using MudBlazor;
@using System.ComponentModel.DataAnnotations;
@using NBG.Visitor.Services.DB;
@using AutoMapper;
@using NBG.Visitor.Storage.Dtos;

@inject VisitContext vc;

<MudGrid Justify=Justify.Center>
    <MudItem lg=7>
        <MudForm @ref="visitorForm">
            <MudGrid Justify=Justify.Center Style="text-align: center;">
                <MudItem xs=6>
                    <MudTextField T="string" bind-Value="FirstName" Label="Vorname" Variant=Variant.Outlined Required="true" RequiredError="Pflichtfeld" />
                </MudItem>
                <MudItem xs=6>
                    <MudTextField T="string" Label="Nachname" Variant=Variant.Outlined Required="true" RequiredError="Pflichtfeld" />
                </MudItem>
                <MudItem xs=12>
                    <MudTextField T="string" Label="Telefonnummer" Variant=Variant.Outlined Required="true" RequiredError="Pflichtfeld" />
                </MudItem>
                <MudItem xs=12>
                    <MudTextField T="string" Label="E-Mail" Variant=Variant.Outlined Validation="@(new EmailAddressAttribute() {ErrorMessage = "Die E-Mail ist ungültig"})" />
                </MudItem>
                <MudItem xs=12>
                    <MudTextField T="string" Label="Unternehmen" Variant=Variant.Outlined Required="true" RequiredError="Pflichtfeld" />
                </MudItem>
                <MudItem xs=12>
                    <MudSelect T="string" Label="Ansprechperson" Variant=Variant.Outlined Required="true" RequiredError="Pflichtfeld">
                        @if (contactPeople != null)
                        {
                            @foreach (ContactPersonDto cp in contactPeople)
                            {
                                <MudSelectItem Value="@(cp.Name)" />
                            }
                        }
                    </MudSelect>
                </MudItem>
                <MudItem xs=12 Style="text-align: right;">
                    <MudButton Variant=Variant.Filled Size=Size.Large EndIcon=@Icons.Outlined.ArrowForward Color=Color.Primary>Weiter</MudButton>
                </MudItem>
            </MudGrid>
        </MudForm>
    </MudItem>
</MudGrid>

@code {
    public IMapper ConfigMapper()
    {
        var config = new AutoMapperConfiguration().Configure();
        return config.CreateMapper();
    }
    private ContactPersonDto[] contactPeople;

    private MudForm visitorForm;

    public string FirstName { get; private set; }

    protected override async Task OnInitializedAsync()
    {
        var mapper = ConfigMapper();
        contactPeople = (await vc.ReadContactPeople()).Select((cp) => mapper.Map<ContactPersonDto>(cp)).ToArray();
        StateHasChanged();
    }
}
